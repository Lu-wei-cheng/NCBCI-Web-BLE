<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>NCBCI Web BLE</title>
  </head>
  <style>

</style>
<body>
<button id="the-button">Try it</button>
<div id="msg">msg</div>
<script>
// 6e400003-b5a3-f393-e0a9-e50e24dcca9e
// Step 1: Scan for a device with 0xffe5 service
<!-- navigator.bluetooth.requestDevice({ -->
  <!-- filters: [{ services: [0xffe5] }] -->
<!-- }) -->
  <!-- .then(function(device) { -->
    <!-- // Step 2: Connect to it -->
    <!-- return device.gatt.connect(); -->
  <!-- }) -->
  <!-- .then(function(server) { -->
    <!-- // Step 3: Get the Service -->
    <!-- return server.getPrimaryService(0xffe5); -->
  <!-- }) -->
  <!-- .then(function(service) { -->
    <!-- // Step 4: get the Characteristic -->
    <!-- return service.getCharacteristic(0xffe9); -->
  <!-- }) -->
  <!-- .then(function(characteristic) { -->
    <!-- // Step 5: Write to the characteristic -->
    <!-- var data = new Uint8Array([0xbb, 0x25, 0x05, 0x44]); -->
    <!-- return characteristic.writeValue(data); -->
  <!-- }) -->
  <!-- .catch(function(error) { -->
     <!-- // And of course: error handling! -->
     <!-- console.error('Connection failed!', error); -->
  <!-- }); -->

const button = document.querySelector('#the-button');
const msg = document.getElementById('msg');

button.addEventListener('click', function() {
	navigator.bluetooth.requestDevice({
		acceptAllDevices: true
	}).then(device => {
		console.log('Got device:', device.name);
		console.log('id:', device.id);
		msg.innerHTML = 'Got device:' + device.name + ',' + 'id:'+ device.id;
	// Chromium 49 及以下版本请使用 connectGATT()
    // Chromium 50 之后版本请使用 gatt.connect()
	return device.gatt.connect();
})
.then(server => {
	console.log('Getting Service…');
	return server.getPrimaryService('6e400001-b5a3-f393-e0a9-e50e24dcca9e');
})
.then(service => {
	console.log('Getting Characteristic…');
	return service.getCharacteristic('6e400003-b5a3-f393-e0a9-e50e24dcca9e');
})
.then(characteristic => {
	console.log('Reading Value …');
	return characteristic.readValue();
})
.then(value => {
	value = value.buffer ? value : new DataView(value);
	console.log('tx value:', value.getUint8(0));
})
.catch(exception => {
	console.log(exception);
});
</script>

</body>
</html>